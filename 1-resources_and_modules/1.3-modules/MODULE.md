# Code reuse

In this section, we will explore the concepts of modules, remote state, and data sources.

## Module

In Terraform, a module is a directory that defines and creates specific resources.

Every Terraform configuration includes at least one module, referred to as the **root module**. The resources created with Terraform files (tf files) stored in the current directory constitute the root module.

Modules can invoke other modules, enabling the inclusion of child modules in the configuration. Additionally, modules can be executed multiple times, using the same or different configurations. This flexibility allows for the packaging and reuse of resources.

For further information, refer to the official documentation on [Terraform modules](https://www.terraform.io/language/modules).

### Running a module

The module structure enables the execution of other modules. In this context, the block label identifies the local module, which is defined by the user. The `source` parameter is mandatory and specifies the location of the other module. The remaining parameters consist of the input variables for the child module.

```hcl
module "servers" {
  source = "./app-cluster"
 
  servers = 5
}
```

A child module can be located on the local file system, Terraform registry, GitHub, Bitbucket, an HTTP URL, or in a cloud bucket (such as S3 or GCP).

The outputs of a child module are encapsulated, and if one wishes to access these outputs, it is necessary to declare output variables.

## Remote State

The default location for the Terraform state file is the local disk. However, if there is a need to share, store, and consume output variables, an option is available to configure remote storage for the state file. This file can be stored in Terraform Cloud, Consul, S3, Alibaba Cloud, and various other locations.

```hcl
terraform {
    backend "s3" {
        region = "us-east-1"
        bucket = "terraform-workshop"
        key = "states/2_1_remote_state.tfstate"
    }
}
```

### Initialization

When a backend is defined, this serves as the initial structure for initialization. Terraform will not load variables declared inside the modules by default, but there are methods available to set these values.

* Interactively: terraform will ask for the values
* File: configuration file can be set with the `init`, this format is a key=value format. E.g.: `terraform init -backend-config=PATH`
* Command line: the values can b defined with this format: `terraform init -backend-config="KEY=VALUE"`
* Hardcoded: the kind of configuration used in this example.

## Data Source

A data source is a structure that enables the retrieval of information for use within Terraform configurations. This information can be sourced from external systems or generated by other configurations.

Here is an example of how to obtain information about the latest version of an AMI:

```hcl
data "aws_ami" "amazon-linux-2" {
 most_recent = true
 owners = ["amazon"]

 filter {
   name   = "name"
   values = ["amzn2-ami-hvm-2.0.*-x86_64-gp2"]
 }
}
```

## Exercise

In this exercise, we will explore the concept of modules. We have a root module where parameters will be set, and a child module that will receive all these parameters.
